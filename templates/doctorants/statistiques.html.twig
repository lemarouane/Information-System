{% extends 'template.html.twig' %}

{% block title %}Statistiques des Doctorants{% endblock %}

{% block body %}
<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
    <div class="breadcrumb-title pe-3">Statistiques des Doctorants</div>
</div>

<div class="row">
    <!-- Gender Distribution -->
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title text-center">Répartition par Genre</h5>
                <hr>
                <div style="position: relative; height: 400px;">
                    <canvas id="genderChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Nationality Distribution -->
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title text-center">Répartition par Nationalité</h5>
                <hr>
                <div style="position: relative; height: 400px;">
                    <canvas id="nationalityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Bac Mentions -->
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title text-center">Répartition des Mentions au Bac</h5>
                <hr>
                <div style="position: relative; height: 400px;">
                    <canvas id="bacMentionsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Average Scores -->
    <div class="col-lg-6 col-md-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title text-center">Statistiques Moyennes</h5>
                <hr>
                <div class="bg-light p-4 rounded">
                    <div class="mb-4">
                        <label><strong>Note Moyenne au Bac:</strong></label>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ data.averageBacNote / 20 * 100 }}%;" aria-valuenow="{{ data.averageBacNote }}" aria-valuemin="0" aria-valuemax="20">
                                {{ data.averageBacNote|number_format(2) }} / 20
                            </div>
                        </div>
                    </div>
                    <div>
                        <label><strong>Note Moyenne au Master:</strong></label>
                        <div class="progress">
                            <div class="progress-bar bg-info" role="progressbar" style="width: {{ data.averageMasterNote / 20 * 100 }}%;" aria-valuenow="{{ data.averageMasterNote }}" aria-valuemin="0" aria-valuemax="20">
                                {{ data.averageMasterNote|number_format(2) }} / 20
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gender Distribution Chart
    const genderChart = new Chart(document.getElementById('genderChart'), {
        type: 'pie',
        data: {
            labels: ['MASCULIN', 'FEMININ'],
            datasets: [{
                data: [{{ data.genderDistribution.MASCULIN }}, {{ data.genderDistribution.FEMININ }}],
                backgroundColor: ['#007bff', '#e83e8c']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { font: { size: 14 } } }
            }
        }
    });

    // Nationality Distribution Chart
    const nationalityChart = new Chart(document.getElementById('nationalityChart'), {
        type: 'bar',
        data: {
            labels: {{ data.nationalityDistribution.labels|json_encode|raw }},
            datasets: [{
                label: 'Nationalités',
                data: {{ data.nationalityDistribution.values|json_encode|raw }},
                backgroundColor: '#28a745'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: { 
                    title: { display: true, text: 'Nationalité', font: { size: 14 } },
                    ticks: { font: { size: 12 }, autoSkip: false }
                },
                y: { 
                    title: { display: true, text: 'Nombre', font: { size: 14 } },
                    ticks: { font: { size: 12 } }
                }
            }
        }
    });

    // Bac Mentions Chart
    const bacMentionsChart = new Chart(document.getElementById('bacMentionsChart'), {
        type: 'doughnut',
        data: {
            labels: {{ data.bacMentions.labels|json_encode|raw }},
            datasets: [{
                data: {{ data.bacMentions.values|json_encode|raw }},
                backgroundColor: ['#17a2b8', '#ffc107', '#28a745', '#dc3545', '#6c757d']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { font: { size: 14 } } }
            }
        }
    });
</script>
{% endblock %}
